# PAVE-Platform 项目需求规划方案

## 1. 项目概述与目标

### 1.1 项目定位
PAVE-Platform 是一个基于PAVE学习框架（Plan、Analysis、Value、Evaluation）的生成式AI增强评估平台，专为大学生反思性日志写作设计。平台通过AI技术辅助学生写作并协助教师进行评估，提升教学效率和学习质量。

### 1.2 核心目标
- **教育目标**：支持基于PAVE框架的反思性学习，提升学生批判性思维能力
- **技术目标**：构建现代化、可扩展的Web平台，集成AI辅助功能
- **用户体验目标**：提供简洁现代的全英文界面，满足师生不同需求
- **效率目标**：通过AI预评估减少教师工作负担，提高评估准确性

### 1.3 约束条件
- **技术约束**：必须使用Next.js 15.4.5 + TypeScript + Supabase技术栈
- **UI约束**：全英文界面，简洁现代设计风格
- **权限约束**：学生和教师无法自主注册，需管理员预设账户
- **AI约束**：使用阿里云百炼大模型（qwen-plus）进行AI辅助功能

## 2. 系统架构设计

### 2.1 整体技术架构

#### 前端架构
- **框架选择**：Next.js 15.4.5 (App Router)
  - **技术论证**：App Router提供更好的性能和开发体验，支持服务端渲染和静态生成，符合现代Web应用标准
  - **关键优势**：自动代码分割、优化的路由系统、内置性能优化

- **UI组件系统**：shadcn/ui + Tailwind CSS 4.x
  - **技术论证**：shadcn/ui提供高质量、可定制的组件库，Tailwind CSS确保一致的设计系统
  - **实施策略**：严格使用官方CLI创建组件，避免手动编写确保一致性

- **富文本编辑器**：Plate.js 49.2.4
  - **技术论证**：内置AI模板，支持数学公式，可扩展性强，符合学术写作需求
  - **AI集成**：利用内置AI功能提供写作提示和辅助

#### 后端架构
- **数据库**：Supabase PostgreSQL
  - **技术论证**：提供完整的BaaS解决方案，内置认证、实时订阅、RLS安全策略
  - **安全策略**：基于RLS的多租户权限控制，确保数据安全隔离

- **认证系统**：Supabase Auth
  - **技术论证**：与数据库深度集成，支持多种认证方式，内置安全最佳实践
  - **权限设计**：基于角色的访问控制（RBAC），支持管理员、教师、学生三级权限

- **API层**：Next.js Server Actions + API Routes
  - **技术论证**：Server Actions提供类型安全的服务端操作，API Routes处理复杂业务逻辑
  - **AI集成**：通过API Routes对接阿里云百炼大模型

### 2.2 数据库设计架构

#### 核心实体关系
```
用户管理层：
- users (用户基础信息)
- user_roles (角色权限)
- classes (班级管理)

课程管理层：
- courses (课程信息)
- course_outlines (课程大纲)
- rubrics (评估量规)
- course_classes (课程-班级关联)

日志管理层：
- journals (学生日志)
- journal_steps (PAVE步骤)
- ai_assessments (AI评估结果)
- teacher_evaluations (教师最终评估)
```

#### 数据安全策略
- **RLS策略**：基于用户角色和数据所有权的行级安全
- **数据隔离**：班级、课程、日志的多层级权限控制
- **审计日志**：关键操作的完整审计追踪

### 2.3 AI集成架构

#### AI服务设计
- **模型配置**：阿里云百炼 qwen-plus 模型
- **API封装**：统一的AI服务接口，支持多种AI功能
- **提示词管理**：结构化的提示词模板系统

#### AI功能模块
1. **写作辅助AI**：基于评估量规生成写作提示
2. **评估AI**：根据课程大纲和评估量规进行日志评估
3. **内容分析AI**：分析日志质量和完整性

## 3. 功能模块规划

### 3.1 用户管理模块

#### 管理员功能
- **账户管理**：
  - 学生账户：支持单个创建和批量导入（Excel）
  - 教师账户：手动创建，随机密码生成
  - 密码管理：安全的密码生成和重置机制

- **班级管理**：
  - CRUD操作：创建、删除、修改、查询班级
  - 学生分组：按班级组织学生，支持批量添加学生账户

**技术实现要点**：
- 使用Supabase Auth的用户管理API
- 实现批量导入的数据验证和错误处理
- 设计灵活的班级-学生关联模型

#### 认证与授权
- **登录机制**：基于Supabase Auth的安全登录
- **会话管理**：JWT token的安全存储和刷新
- **权限验证**：中间件层面的路由权限控制

### 3.2 课程管理模块

#### 教师课程功能
- **课程创建**：
  - 基础信息：课程名称、描述、封面、开课时间（范围）
  - 课程大纲：结构化的课程内容描述
  - 授课班级：灵活的班级分配机制

- **评估量规管理**：
  - PAVE步骤配置：每个步骤的具体要求和标准
  - 评分标准：详细的评估维度和权重设置
  - 关联课程：每个课程的评估量规是独立的

- **日志设置**：
  - 提交次数：每个PAVE步骤的日志提交限制
  - 截止时间：灵活的时间管理系统
  - 权限控制：基于时间和状态的提交权限

**技术实现要点**：
- 设计灵活的课程-班级多对多关联
- 实现基于时间的权限控制逻辑
- 构建可扩展的评估量规数据结构

### 3.3 日志写作模块

#### 学生写作功能
- **日志编辑器**：
  - 基于Plate.js的富文本编辑器
  - 数学公式支持：LaTeX语法集成
  - AI写作辅助：基于课程大纲的智能提示

- **PAVE步骤管理**：
  - 独立编辑：每个步骤的独立编辑环境
  - 状态管理：草稿、已提交状态的明确区分

- **版本控制**：
  - 自动保存：定期保存草稿状态
  - 提交确认：明确的提交操作和确认机制
  - 修改限制：提交后的不可修改策略

**技术实现要点**：
- 集成Plate.js AI模板，配置阿里云百炼模型
- 实现实时保存
- 设计清晰的状态机管理日志状态

#### AI写作辅助
- **智能提示**：基于当前步骤和评估量规生成写作建议
- **内容分析**：实时分析写作质量和完整性
- **格式建议**：根据学术写作标准提供格式指导

### 3.4 评估管理模块

#### AI评估系统
- **评估触发**：学生完成所有PAVE步骤提交日志后触发
- **评估逻辑**：
  - 课程大纲匹配：检查日志内容与课程目标的契合度
  - 量规对照：基于预设评估标准进行多维度评估
  - 质量分析：分析写作质量、逻辑性、深度等

- **结果生成**：
  - 结构化评估：按PAVE步骤和评估维度组织结果
  - 改进建议：基于评估结果生成具体改进建议
  - 置信度评估：AI评估结果的可信度指标

**技术实现要点**：
- 设计灵活的提示词模板系统
- 实现评估结果的结构化存储
- 构建评估质量的反馈机制

#### 教师评估功能
- **评估界面**：
  - 日志查看：完整的学生日志展示
  - AI参考：AI评估结果的参考展示
  - 评分工具：直观的评分和评语输入界面

- **评估管理**：
  - 批量评估：支持批量查看和评估
  - 评估历史：完整的评估记录和修改历史

### 3.5 界面与交互模块

#### 导航系统
- **顶部导航**：首页、团队介绍、课程列表、我的日志、课程管理、用户管理
- **权限导航**：基于用户角色的动态导航菜单
- **面包屑导航**：清晰的页面层级指示

#### 响应式设计
- **移动适配**：支持平板和手机设备的响应式布局
- **交互优化**：触摸友好的界面元素设计
- **性能优化**：移动端的加载速度和交互流畅性

**技术实现要点**：
- 使用Tailwind CSS的响应式工具类
- 实现基于角色的条件渲染
- 优化移动端的编辑器体验

## 4. 关键设计决策

### 4.1 架构决策

#### 单体vs微服务架构
**决策**：采用Next.js单体架构
**论证**：
- 项目规模适中，单体架构降低复杂性
- Next.js提供完整的全栈解决方案
- 便于快速开发和部署
- 后期可根据需要进行微服务拆分

#### 状态管理策略
**决策**：使用React内置状态管理
**论证**：
- 避免过度工程化，减少学习成本
- 组件级状态管理满足大部分需求
- 不需要引入其他任何第三方状态管理

#### 数据库设计策略
**决策**：关系型数据库 + 适度反范式化
**论证**：
- PostgreSQL提供强一致性和复杂查询能力
- 教育场景的数据关系复杂，适合关系型数据库
- 适度反范式化提升查询性能
- Supabase提供完整的数据库管理工具

### 4.2 安全设计决策

#### 权限控制策略
**决策**：基于RLS的多层级权限控制
**论证**：
- 数据库层面的安全控制，防止权限绕过
- 支持复杂的多租户权限需求
- 与Supabase Auth深度集成
- 便于审计和合规要求

#### 数据隐私保护
**决策**：最小权限原则 + 数据加密
**论证**：
- 学生日志涉及隐私，需要严格保护
- 基于角色的最小权限访问
- 敏感数据的传输和存储加密
- 符合教育数据保护法规

### 4.3 性能设计决策

#### 缓存策略
**决策**：多层级缓存 + 智能失效
**论证**：
- Next.js内置缓存 + CDN缓存
- Supabase查询缓存
- 客户端状态缓存
- 基于数据变更的智能缓存失效

#### 加载优化
**决策**：渐进式加载 + 代码分割
**论证**：
- 按路由和功能模块进行代码分割
- 富文本编辑器的懒加载
- 图片和媒体资源的优化加载
- 关键路径的优先加载

---

*本规划方案将根据项目进展和反馈持续更新优化，确保项目成功交付。*